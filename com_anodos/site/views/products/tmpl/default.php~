<?php
// No direct access to this file
defined('_JEXEC') or die('Restricted access');

// Подключаем скрипты и стили
$doc = JFactory::getDocument();
$doc->addScript($this->baseurl.'/components/com_anodos/js/products.js', 'text/javascript', true);
$doc->addStyleSheet($this->baseurl.'/components/com_anodos/css/style.css');

// Определяем уровень доступа
$canDo = AnodosHelper::getActions();

echo $this->msg;
?>
<div class="row">
	<div class="col-sm-4 col-md-2"><p>Категория:</p></div>
	<div class="col-sm-8 col-md-10 closed" id="b2b-categories" >
		<?php
			if (true == $this->categorySelected) {
				echo "<span id=\"category-selected-square\" onClick=\"openCategories()\">&#8862;</span>";
				echo "<span>&nbsp;</span>";
				echo "<span id=\"category-selected-text\" onClick=\"openCategories()\">
					{$this->categorySelected->title}
					</span>";
			} else {
				echo "<span id=\"category-selected-square\" onClick=\"openCategories()\">&#8862;</span>";
				echo "<span>&nbsp;</span>";
				echo "<span id=\"category-selected-text\" onClick=\"openCategories()\">";
				echo JText::_('COM_ANODOS_SELECT_CATEGORY');
				echo "</span>";
			}
			echo $this->categories;
		?>
	</div>
</div>
<div class="row">
	<div class="col-sm-4 col-md-2"><p>Производитель:</p></div>
	<div class="col-sm-8 col-md-10 closed" id="b2b-vendors">
		<?php
			if (true == $this->vendorSelected) {
				echo "<span id=\"vendor-selected-square\" onClick=\"openVendors()\">&#8862;</span>&nbsp;";
				echo "<span id=\"vendor-selected-text\" onClick=\"openVendors()\">{$this->vendorSelected->name}</span>";
			} else {
				echo "<span id=\"vendor-selected-square\" onClick=\"openVendors()\">&#8862;</span>&nbsp;";
				echo "<span id=\"vendor-selected-text\" onClick=\"openVendors()\">";
				echo JText::_('COM_ANODOS_ALL_VENDORS');
				echo "</span>";
			}
		?>
		<ul>
			<li id="vendor-0" onClick="setVendorSelected(0)"><?php echo JText::_('COM_ANODOS_ALL_VENDORS'); ?></li>
			<?php foreach($this->vendors as $i => $vendor): ?>
			<li id="vendor-<?php echo $vendor->id; ?>" onClick="setVendorSelected(<?php echo $vendor->id; ?>)">
				<?php echo $vendor->name; ?>
			</li>
			<?php endforeach; ?>
		</ul>
	</div>
</div>
<div class="row">
	<div class="col-md-12">
		<form  role="form" action="" method="get" name="form">
			<div class="form-group">
				<input
					id="form-category-selected"
					type="hidden"
					name="category"
					value="<?php if (true == $this->categorySelected) {echo $this->categorySelected->id;} else {echo 0;} ?>"
				/>
				<input
					id="form-vendor-selected"
					type="hidden"
					name="vendor"
					value="<?php if (true == $this->vendorSelected) {echo $this->vendorSelected->id;} else {echo 0;} ?>"
				/>
				<button type="submit" class="btn btn-default"><?php echo JText::_('COM_ANODOS_SHOW'); ?></button>
			</div>
		</form>
	</div>
</div>
<?php
	$col = 0;
	$lastCategoryId = 0;
?>
<div class="row">
	<div class="table-responsive">
		<table class="table table-bordered">
			<thead>
				<tr>
					<th><?php echo JText::_('COM_PRICER_N'); $col++; ?></th>
					<th><?php echo JText::_('COM_PRICER_ARTICLE'); $col++; ?></th>
					<th><?php echo JText::_('COM_PRICER_NAME'); $col++; ?></th>
					<th><?php echo JText::_('COM_PRICER_VENDOR'); $col++; ?></th>
					<th><?php echo JText::_('COM_PRICER_PRICE_IN'); $col++; ?></th>
					<th><?php echo JText::_('COM_PRICER_PRICE_OUT'); $col++; ?></th>
					<th><?php echo JText::_('COM_PRICER_QUANTITY'); $col++; ?></th>
					<th><?php echo JText::_('COM_PRICER_DISTRIBUTOR'); $col++; ?></th>
					<th><?php echo JText::_('COM_PRICER_DELIVERY_TIME'); $col++; ?></th>
				</tr>
			</thead>
			<tbody>
				<?php foreach($this->products as $i => $product): ?>
				<?php if ($lastCategoryId != $product->category_id) : ?>
				<tr class="active" >
					<td colspan="<?php echo $col; ?>"><b><?php echo $product->category_name; ?></b></td>
				</tr>
				<?php endif; $lastCategoryId = $product->category_id; ?>
				<tr data-product-id="<?php echo $product->product_id; ?>">
					<td><?php echo $i+1; ?></td>
					<td><?php echo $product->product_article; ?></td>
					<td><?php echo $product->product_name; ?></td>
					<td><?php echo $product->vendor_name; ?></td>
					<td>TODO&nbsp;TODO</td>
					<td>TODO&nbsp;TODO</td>
					<td>TODO</td>
					<td>TODO</td>
					<td>TODO</td>
				</tr>
			<?php endforeach; ?>
			</tbody>
		</table>
	</div>
</div>
